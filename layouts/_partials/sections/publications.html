<section id="publications" class="section">
  <div class="container">
    <div class="hr">
      <div class="tk"></div>
    </div>
  </div>
  <div class="container">
    <h2 class="section-header">Publications</h2>
  </div>
  <div class="container">
    <div class="publications">

      {{ with site.GetPage "publications" }}
      {{ range sort .Pages "Date" "desc" }}
      {{ $slug := index (last 1 .SectionsEntries) 0 }}

      <div class="publication columns">
        <div class="column is-4 publication-cover-column">
          <div class="publication-cover" style="width: 100%">
            {{ with .Resources.Get "cover.jpg" }}
            <img src="{{ .RelPermalink }}" width="{{ .Width }}" height="{{ .Height }}" class="hover-1">
            {{ end }}
            {{ with .Resources.Get "cover.mp4" }}
            <video autoplay loop muted playsinline class="hover-2">
              <source src="{{ .RelPermalink }}" type="video/mp4">
              Your browser does not support the video tag.
            </video>
            {{ end }}
          </div>
        </div>

        <div class="column">
          <h3 class="publication-title">{{ .Title }}</h3>
          <div class="publication-conference">{{ .Params.Conference }}{{ if .Params.Bonus }} <span class="bonus">({{
              .Params.Bonus }})</span>{{ end }}</div>

          <div class="publication-description">
            {{ .Content }}
          </div>

          <div class="publication-authors">
            {{ range $index, $element := .Params.Authors }}{{ if gt $index 0}}, {{ end }}{{ if eq . "Tim Walter"}}<span
              class="author-me">{{ . }}</span>{{ else }}{{ . }}{{ end }}{{ end }}
          </div>

          {{/* Unique modal ID per page */}}
          {{ $id := .File.UniqueID }}

          <div class="publication-links">
            {{ range $index, $element := .Params.Links }}
            <span class="publication-link"><a href="{{ .url }}" target="_blank">{{ .name }}</a></span>
            {{ end }}

            {{ if .Params.Bibtex }}
            <span class="publication-link">
              <a data-target="modal-bibtex-{{ $id }}" class="js-modal-trigger">Bibtex</a>
            </span>
            {{ end }}
          </div>
        </div>
      </div>
 {{ if .Params.Bibtex }}
    {{ $bibtex_path := replace .File.Path "index.md" .Params.Bibtex }}
    <div id="modal-bibtex-{{ $id }}" class="modal">
      <div class="modal-background"></div>
      <div class="modal-card">
        <section class="modal-card-body">
          <div class="code-block-wrapper">
            <pre class="bibtex-pre"><code id="bibtex-{{ $id }}">{{ readFile $bibtex_path }}</code></pre>

            <!-- Actions (top-right, embedded) -->
            <div class="code-actions">
              <a class="download-icon-btn"
                 href="{{ .RelPermalink }}{{ .Params.Bibtex }}"
                 download="{{ .Params.Bibtex }}"
                 aria-label="Download BibTeX"
                 title="Download BibTeX">
                <i class="fa-solid fa-download"></i>
              </a>

              <button type="button"
                      class="copy-icon-btn"
                      aria-label="Copy BibTeX"
                      title="Copy BibTeX"
                      data-target="bibtex-{{ $id }}">
                <i class="fa-regular fa-clone"></i>
              </button>
            </div>
          </div>
        </section>
      </div>
    </div>
  {{ end }}
      {{ end }}
      {{ end }}
    </div>
  </div>
</section>